# XMRigISO Server Validator

## Overview

The XMRigISO Server Validator is the primary client component designed for use
within a custom XMRigISO Monero miner live system image. This program endeavors
to verify whether a given set of XMRigISO Servers can be trusted by having the
server sign random bytes generated by the client. This requires a custom
OpenResty server implementing the xmrigiso-server configuration. The server
provides scripts to assist client systems in patching, configuring, compiling,
running, and connecting their Monero miners to the xmrigiso-server's pool,
providing remote management capabilities via SSH and XMRig's own HTTP API.

## Features

- **Server Validation**: Utilizes an Ed25519 key pair to validate the server's
  authenticity. Random data is sent to the server, and the returned signature is
  verified against a local or built-in public key.
- **Secure Communication**: Ensures that only trusted servers can interact with
  client systems, enhancing the security of the mining operation.
- **Flexible Configuration**: Supports both local and built-in public keys for
  signature verification, as well as custom SOCKS5 proxies for Tor and I2P
  servers, providing flexibility in deployment.

## Building

To build the XMRigISO Server Validator, clone the repository, generate or copy
over your XMRigISO Server key pair, and build the project using Cargo:

```sh
git clone https://github.com/lucca-pellegrini/xmrigiso-server-validator.git
cd xmrigiso-server-validator
openssl genpkey -algorithm ed25519 -out private_key.pem
openssl pkey -in private_key.pem -pubout -out public_key.pem
cargo build --release
```

## Usage

Run the validator with the necessary command-line arguments to specify the host,
as well as the proxy settings:

```sh
cargo run -- [--key <path_to_public_key>] [--tor-proxy <tor_proxy>] [--i2p-proxy <i2p_proxy>] <hostname> [socks5_proxy]
```

For a complete list of options, use the `--help` flag:

```sh
cargo run -- --help
```

## Deploying

Simply include the compiled executable
(`target/release/xmrigiso-server-validator`) in the `airootfs/etc/skel/`
directory of the XMRigISO repository, optionally compressing it with
[`upx`](https://upx.github.io/), and rebuild the image:

```sh
cd /path/to/xmrigiso
sudo rm -r out work
cp /path/to/xmrigiso-server-validator/target/release/xmrigiso-server-validator airootfs/etc/skel/
upx --best --lzma airootfs/etc/skel/xmrigiso-server-validator # Optional
sudo mkarchiso -v .
```

The newer versions of the XMRigISO login script _should_ detect the program on
first login, and run it automatically with the default hosts list. If this
fails, it may prompt the user to fall back to the old, unsafe, manual
configuration.

After (re)building the image, it may be worthwhile to test it, especially to
detect potentially missing libraries:

```sh
run_archiso -ui out/xmriso-????.??.??-x86_64.iso
```

## Contributing

If you happen to find a use for this program, contributions are welcome! Please
commit your changes and send me your patches with
[`git send-email`](https://git-send-email.io/). Here's an example:

```sh
git config sendemail.to "patches@verticordia.com"
git config format.subjectPrefix "PATCH xmrigiso-server-validator"
git send-email <reference>
```

If you'd prefer, you can also fork the repository and submit a pull request with
your changes.

## Copyright

This project is licensed under the Apache License, Version 2.0. See the
[LICENSE](LICENSE) file for more details.
